# Lisa 产出物生成测试

## 测试目标

验证 Lisa 智能体在测试设计工作流中能正确生成和渲染各阶段产出物（Artifacts）。

## 前置条件

- [ ] Docker 环境已启动 (`docker ps | grep ai4se-agents`)
- [ ] 服务健康 (http://localhost/ai-agents 可访问)
- [ ] Chrome DevTools MCP 已连接
- [ ] 已完成 lisa-smoke.md 冒烟测试

---

## TC-AR-01: 需求澄清产出物初始化

**优先级:** P0 (核心路径)

**目标:** 验证进入测试设计工作流后，需求分析文档能正确初始化和显示

### 测试步骤

1. **打开智能体页面**
   - 导航到 `http://localhost/ai-agents`
   - 点击 Lisa 智能体进入对话

2. **触发测试设计工作流**
   - 发送消息: `我需要设计一个用户登录功能的测试方案`
   - 等待 AI 回复（应该是 Lisa 的欢迎语和问题）

3. **检查产出物面板**
   - 观察右侧产出物面板
   - 应该显示 "需求分析文档" 或类似标题

4. **提供需求信息**
   - 发送消息: `这是一个 Web 应用的登录功能，支持用户名密码登录和手机验证码登录`
   - 等待 AI 回复

### 验证项

- [ ] 进入工作流后，右侧产出物面板出现
- [ ] 产出物面板显示 "需求澄清" 阶段
- [ ] 对话后产出物内容有更新（显示需求相关信息）
- [ ] 产出物内容包含用户提供的需求点

### 产出物 Key

`test_design_requirements`

---

## TC-AR-02: 策略蓝图生成

**优先级:** P0 (核心路径)

**目标:** 验证从需求澄清阶段推进到策略制定阶段，策略蓝图能正确生成

### 前置条件

- 已完成 TC-AR-01，处于需求澄清阶段

### 测试步骤

1. **确认需求完成**
   - 发送消息: `需求已经清楚了，请帮我制定测试策略`
   - 等待 AI 回复（应该进入策略制定阶段）

2. **检查阶段流转**
   - 观察顶部工作流进度条
   - 应该显示 "策略制定" 阶段高亮

3. **检查产出物更新**
   - 观察右侧产出物面板
   - 应该显示测试策略相关内容

### 验证项

- [ ] 工作流进度条显示进入 "策略制定" 阶段
- [ ] 产出物面板标题变更为策略相关
- [ ] 产出物内容包含：测试策略、风险分析、优先级等
- [ ] 可以通过进度条点击切换查看之前阶段的产出物

### 产出物 Key

`test_design_strategy`

---

## TC-AR-03: Mermaid 流程图渲染

**优先级:** P1

**目标:** 验证产出物中的 Mermaid 图表能正确渲染为 SVG

### 测试步骤

1. **进入工作流**
   - 发送消息: `请帮我设计一个订单支付流程的测试方案`
   - 等待 AI 进入测试设计工作流

2. **提供复杂流程**
   - 发送消息: `流程是：用户下单 -> 选择支付方式 -> 调用支付接口 -> 等待回调 -> 更新订单状态`
   - 等待 AI 回复

3. **检查流程图渲染**
   - 观察产出物面板
   - 查找 Mermaid 图表区域

### 验证项

- [ ] 产出物中出现流程图区域
- [ ] 流程图渲染为 SVG（不是纯文本代码）
- [ ] 流程图正确显示节点和连接线
- [ ] 无 Mermaid 渲染错误提示

### 技术验证

- Mermaid 图表容器包含 `<svg>` 元素
- 图表 ID 格式: `mermaid-diagram-{n}`

---

## TC-AR-04: 测试用例集生成

**优先级:** P0 (核心路径)

**目标:** 验证用例编写阶段能正确生成测试用例集

### 前置条件

- 已完成策略制定阶段

### 测试步骤

1. **推进到用例阶段**
   - 发送消息: `策略确定了，请开始设计具体的测试用例`
   - 等待 AI 进入用例编写阶段

2. **检查用例生成**
   - 观察产出物面板
   - 应该显示测试用例列表

### 验证项

- [ ] 工作流进度条显示进入 "用例编写" 阶段
- [ ] 产出物包含测试用例列表
- [ ] 每个用例包含：标题、前置条件、步骤、预期结果
- [ ] 用例与之前分析的需求相关

### 产出物 Key

`test_design_cases`

---

## TC-AR-05: 产出物 TOC 导航

**优先级:** P1

**目标:** 验证产出物面板的目录导航功能

### 测试步骤

1. **生成包含多个章节的产出物**
   - 完成 TC-AR-02 后，产出物应有多个章节

2. **点击 TOC 导航项**
   - 在产出物面板左侧找到目录
   - 点击不同的章节标题

3. **验证滚动效果**
   - 观察产出物内容区域是否滚动到对应位置

### 验证项

- [ ] 产出物面板显示 TOC 目录
- [ ] 点击目录项后内容区域滚动
- [ ] 当前查看的章节在 TOC 中高亮

---

## TC-AR-06: 历史阶段产出物查看

**优先级:** P1

**目标:** 验证可以通过工作流进度条查看历史阶段的产出物

### 前置条件

- 已完成至少 2 个阶段（如需求澄清 + 策略制定）

### 测试步骤

1. **点击历史阶段**
   - 在顶部工作流进度条上
   - 点击之前完成的阶段（如 "需求澄清"）

2. **验证产出物切换**
   - 观察产出物面板内容变化

3. **返回当前阶段**
   - 点击 "返回当前阶段" 按钮
   - 或点击当前阶段节点

### 验证项

- [ ] 点击历史阶段后产出物内容切换
- [ ] 显示该阶段对应的产出物内容
- [ ] 出现 "返回当前阶段" 提示或按钮
- [ ] 可以正确返回当前阶段

---

## TC-AR-07: 产出物实时更新

**优先级:** P0 (核心路径)

**目标:** 验证对话过程中产出物能实时更新（流式渲染）

### 测试步骤

1. **发送会产生产出物更新的消息**
   - 在需求澄清阶段
   - 发送消息: `补充一下，还需要支持第三方登录（微信、支付宝）`

2. **观察实时更新**
   - 在 AI 回复过程中
   - 观察产出物面板是否实时变化

### 验证项

- [ ] AI 回复过程中产出物有更新动画/指示
- [ ] 不需要刷新页面即可看到最新内容
- [ ] 新增内容正确追加到产出物中

---

## TC-AR-08: 完整工作流产出物检验

**优先级:** P0 (端到端)

**目标:** 验证完成整个测试设计工作流后，所有产出物都正确生成

### 测试步骤

1. **完成全部 4 个阶段**
   - 需求澄清 → 策略制定 → 用例编写 → 文档交付
   - 按照工作流指引完成对话

2. **检查最终交付文档**
   - 在 "文档交付" 阶段
   - 验证最终产出物整合了前面所有阶段内容

### 验证项

- [ ] 工作流进度条显示所有 4 个阶段完成
- [ ] 最终文档包含：需求摘要、测试策略、测试用例
- [ ] 各阶段产出物都可以通过进度条回看
- [ ] 无产出物丢失或覆盖

### 产出物 Key

`test_design_final`

---

## 故障排查

### 产出物面板不显示

- 检查是否成功进入工作流（非 clarify_intent）
- 检查 Console 是否有 JavaScript 错误
- 检查网络请求 `/sync` 是否成功

### Mermaid 图表不渲染

- 检查 Console 是否有 Mermaid 相关错误
- 图表语法可能不正确，等待 AI 修正
- 刷新页面重试

### 产出物内容为空

- 检查后端日志 `docker logs ai4se-agents --tail 50`
- 可能 LLM 响应未触发 artifact 更新
- 继续对话可能会触发更新

### 阶段无法流转

- 检查是否满足阶段退出条件（DoR）
- 尝试明确请求："请进入下一阶段"

---

## 附录：产出物 Key 映射

| 阶段 | Key | 产出物名称 |
|------|-----|------------|
| clarify | `test_design_requirements` | 需求分析文档 |
| strategy | `test_design_strategy` | 测试策略蓝图 |
| cases | `test_design_cases` | 测试用例集 |
| delivery | `test_design_final` | 测试设计文档 |
