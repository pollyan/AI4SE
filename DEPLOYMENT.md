# GitHub Actions SCP/SSH æ¨é€éƒ¨ç½²æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®ç°å·²é‡‡ç”¨ **GitHub Actions + SCP/SSH æ¨é€æ¨¡å¼**è¿›è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œè§£å†³äº†è…¾è®¯äº‘æœåŠ¡å™¨è®¿é—® GitHub ç½‘ç»œæ…¢çš„é—®é¢˜ã€‚

## ğŸš€ éƒ¨ç½²æµç¨‹

```mermaid
graph LR
    A[Push ä»£ç åˆ° main] --> B[GitHub Actions è¿è¡Œæµ‹è¯•]
    B --> C{æµ‹è¯•é€šè¿‡?}
    C -->|å¦| D[åœæ­¢éƒ¨ç½²]
    C -->|æ˜¯| E[æ‰“åŒ…é¡¹ç›®æ–‡ä»¶]
    E --> F[SCP æ¨é€åˆ°æœåŠ¡å™¨]
    F --> G[æ‰§è¡Œéƒ¨ç½²è„šæœ¬]
    G --> H[Docker é‡æ–°æ„å»º]
    H --> I[é‡å¯æœåŠ¡]
    I --> J[å¥åº·æ£€æŸ¥]
    J --> K{æ£€æŸ¥é€šè¿‡?}
    K -->|æ˜¯| L[éƒ¨ç½²æˆåŠŸ âœ…]
    K -->|å¦| M[è‡ªåŠ¨å›æ»š âš ï¸]
```

## âœ¨ æ ¸å¿ƒä¼˜åŠ¿

- âœ… **å®Œå…¨è§„é¿ç½‘ç»œé—®é¢˜** - æœåŠ¡å™¨ä¸éœ€è¦è®¿é—® GitHub
- âœ… **æ„å»ºåœ¨ GitHub** - åˆ©ç”¨ GitHub å…è´¹ CI/CD èµ„æº
- âœ… **å¿«é€Ÿéƒ¨ç½²** - åªä¼ è¾“å¿…è¦æ–‡ä»¶ï¼Œä½“ç§¯å°
- âœ… **è‡ªåŠ¨å›æ»š** - éƒ¨ç½²å¤±è´¥è‡ªåŠ¨æ¢å¤åˆ°ä¸Šä¸€ç‰ˆæœ¬
- âœ… **å®‰å…¨æ€§é«˜** - æœåŠ¡å™¨ä¸å­˜å‚¨ `.git` å†å²

## ğŸ”§ GitHub Secrets é…ç½®

éƒ¨ç½²éœ€è¦ä»¥ä¸‹ GitHub Secretsï¼ˆå·²é…ç½®ï¼‰ï¼š

| Secret åç§° | è¯´æ˜ | ç¤ºä¾‹ |
|------------|------|------|
| `SSH_PRIVATE_KEY` | SSH ç§é’¥ | `-----BEGIN OPENSSH PRIVATE KEY-----...` |
| `SERVER_HOST` | æœåŠ¡å™¨ IP æˆ–åŸŸå | `43.xxx.xxx.xxx` |
| `SERVER_USER` | æœåŠ¡å™¨ç”¨æˆ·å | `ubuntu` |

## ğŸ“ æœåŠ¡å™¨ç›®å½•ç»“æ„

```
/opt/
â”œâ”€â”€ intent-test-framework/        # å½“å‰è¿è¡Œç‰ˆæœ¬
â”œâ”€â”€ intent-test-framework-upload/ # ä¸Šä¼ çš„æ–°ç‰ˆæœ¬ï¼ˆä¸´æ—¶ï¼‰
â””â”€â”€ intent-test-framework-backup/ # å¤‡ä»½ç›®å½•
    â””â”€â”€ latest/                    # æœ€æ–°å¤‡ä»½
```

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### è‡ªåŠ¨éƒ¨ç½²ï¼ˆæ¨èï¼‰

åªéœ€å°†ä»£ç æ¨é€åˆ° `main` æˆ– `master` åˆ†æ”¯ï¼š

```bash
git add .
git commit -m "ä½ çš„æäº¤ä¿¡æ¯"
git push origin main
```

GitHub Actions ä¼šè‡ªåŠ¨ï¼š
1. è¿è¡Œ API æµ‹è¯•
2. æ‰“åŒ…é¡¹ç›®æ–‡ä»¶
3. æ¨é€åˆ°è…¾è®¯äº‘æœåŠ¡å™¨
4. æ‰§è¡Œéƒ¨ç½²è„šæœ¬
5. é‡å¯æœåŠ¡
6. è¿›è¡Œå¥åº·æ£€æŸ¥

### æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€

åœ¨ GitHub ä»“åº“é¡µé¢ï¼š
1. ç‚¹å‡» **Actions** æ ‡ç­¾
2. æŸ¥çœ‹æœ€æ–°çš„å·¥ä½œæµè¿è¡Œè®°å½•
3. ç‚¹å‡»è¿›å…¥æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

### éƒ¨ç½²å¤±è´¥æ—¶çš„å¤„ç†

å¦‚æœéƒ¨ç½²å¤±è´¥ï¼Œç³»ç»Ÿä¼š**è‡ªåŠ¨å›æ»š**åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ã€‚ä½ å¯ä»¥ï¼š

1. **æŸ¥çœ‹ GitHub Actions æ—¥å¿—** - äº†è§£å¤±è´¥åŸå› 
2. **SSH ç™»å½•æœåŠ¡å™¨æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**ï¼š
   ```bash
   ssh ubuntu@your-server-ip
   docker-compose -f /opt/intent-test-framework/docker-compose.prod.yml logs --tail=100
   ```

### æ‰‹åŠ¨å›æ»š

å¦‚éœ€æ‰‹åŠ¨å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬ï¼š

```bash
# SSH ç™»å½•æœåŠ¡å™¨
ssh ubuntu@your-server-ip

# æ‰§è¡Œå›æ»š
cd /opt/intent-test-framework-backup/latest
sudo rsync -a . /opt/intent-test-framework/
cd /opt/intent-test-framework
docker-compose -f docker-compose.prod.yml up -d
```

## ğŸ” å¥åº·æ£€æŸ¥

éƒ¨ç½²å®Œæˆåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æŸ¥ä»¥ä¸‹ç«¯ç‚¹ï¼š
- `http://localhost:5001/health`

å¥åº·æ£€æŸ¥ä¼šé‡è¯•æœ€å¤š 10 æ¬¡ï¼ˆæ¯æ¬¡é—´éš” 3 ç§’ï¼‰ï¼Œç¡®ä¿æœåŠ¡æ­£å¸¸å¯åŠ¨ã€‚

## ğŸ“ é¦–æ¬¡éƒ¨ç½²æ³¨æ„äº‹é¡¹

å¦‚æœæ˜¯é¦–æ¬¡éƒ¨ç½²ï¼Œéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šæ‰‹åŠ¨åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# SSH ç™»å½•æœåŠ¡å™¨
ssh ubuntu@your-server-ip

# åˆ›å»º .env æ–‡ä»¶
cd /opt/intent-test-framework
cp .env.docker.example .env
nano .env  # ç¼–è¾‘é…ç½®
```

å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼š
```env
DATABASE_URL=postgresql://user:password@host:port/database
SECRET_KEY=your-secret-key-here
FLASK_ENV=production
WEB_PORT=5001
```

## ğŸ› ï¸ æ’æŸ¥é—®é¢˜

### é—®é¢˜ 1: SCP ä¸Šä¼ è¶…æ—¶

**åŸå› **: æ–‡ä»¶å¤ªå¤§æˆ–ç½‘ç»œæ…¢

**è§£å†³æ–¹æ¡ˆ**: 
- æ£€æŸ¥ `.github/workflows/deploy.yml` ä¸­çš„ `exclude` åˆ—è¡¨
- ç¡®ä¿æ²¡æœ‰å°† `node_modules`ã€æ—¥å¿—ç­‰å¤§æ–‡ä»¶æ¨é€åˆ° Git

### é—®é¢˜ 2: éƒ¨ç½²è„šæœ¬æ‰§è¡Œå¤±è´¥

**åŸå› **: æƒé™ä¸è¶³æˆ–è„šæœ¬é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x /opt/intent-test-framework/scripts/deploy-from-upload.sh

# æŸ¥çœ‹è„šæœ¬æ‰§è¡Œæ—¥å¿—
cd /opt/intent-test-framework
docker-compose -f docker-compose.prod.yml logs
```

### é—®é¢˜ 3: å¥åº·æ£€æŸ¥å¤±è´¥

**åŸå› **: æœåŠ¡å¯åŠ¨æ…¢æˆ–é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f /opt/intent-test-framework/docker-compose.prod.yml ps

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose -f /opt/intent-test-framework/docker-compose.prod.yml logs web-app

# æ‰‹åŠ¨æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:5001/health
```

## ğŸ“š ç›¸å…³æ–‡ä»¶

- **å·¥ä½œæµé…ç½®**: `.github/workflows/deploy.yml`
- **éƒ¨ç½²è„šæœ¬**: `scripts/deploy-from-upload.sh`
- **Docker é…ç½®**: `docker-compose.prod.yml`
- **æ¶æ„è¯´æ˜**: `ARCHITECTURE_DEPLOYMENT.md`

## ğŸ”„ ä¸æ—§éƒ¨ç½²æ–¹å¼çš„åŒºåˆ«

| ç‰¹æ€§ | æ—§æ–¹å¼ (Git Pull) | æ–°æ–¹å¼ (SCP Push) |
|------|------------------|-------------------|
| ç½‘ç»œä¾èµ– | æœåŠ¡å™¨éœ€è®¿é—® GitHub | æœåŠ¡å™¨æ— éœ€è®¿é—® GitHub |
| æ„å»ºä½ç½® | æœåŠ¡å™¨ä¸Š | GitHub Actions |
| éƒ¨ç½²é€Ÿåº¦ | æ…¢ï¼ˆæ‹‰å–ä»£ç  + æ„å»ºï¼‰ | å¿«ï¼ˆåªä¼ è¾“å¿…è¦æ–‡ä»¶ï¼‰ |
| èµ„æºæ¶ˆè€— | æœåŠ¡å™¨èµ„æº | GitHub å…è´¹èµ„æº |
| å›æ»šæœºåˆ¶ | æ‰‹åŠ¨ | è‡ªåŠ¨ |

## ğŸ’¡ æœ€ä½³å®è·µ

1. **é¢‘ç¹æäº¤å°æ”¹åŠ¨** - ä¾¿äºå¿«é€Ÿå®šä½é—®é¢˜
2. **åˆå¹¶å‰æœ¬åœ°æµ‹è¯•** - ç¡®ä¿ä»£ç è´¨é‡
3. **å…³æ³¨ Actions æ—¥å¿—** - åŠæ—¶å‘ç°éƒ¨ç½²é—®é¢˜
4. **å®šæœŸå¤‡ä»½æ•°æ®åº“** - é˜²æ­¢æ•°æ®ä¸¢å¤±
5. **ç›‘æ§æœåŠ¡å™¨èµ„æº** - ç¡®ä¿æœåŠ¡æ­£å¸¸è¿è¡Œ

---

**éƒ¨ç½²æ„‰å¿«ï¼** ğŸ‰ å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ GitHub Actions æ—¥å¿—æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚
