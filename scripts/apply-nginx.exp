#!/usr/bin/expect -f

set timeout 30
set server_ip "120.53.220.231"
set server_user "ubuntu"
set server_pass "Shunlian04"

puts "ğŸ”§ åº”ç”¨Nginxé…ç½®..."

spawn ssh -t ${server_user}@${server_ip}
expect "password:"
send "$server_pass\r"

expect "$ "
send "sudo docker cp /tmp/nginx.conf.new intent-test-nginx:/etc/nginx/nginx.conf\r"

sleep 2

expect "$ "
send "sudo docker exec intent-test-nginx nginx -t\r"

sleep 2

expect "$ "
send "sudo docker exec intent-test-nginx nginx -s reload\r"

sleep 2

expect "$ "
send "curl -I http://localhost/testcases 2>&1 | head -5\r"

sleep 2

expect "$ "
send "exit\r"

puts "\nâœ… å®Œæˆï¼"

expect eof
